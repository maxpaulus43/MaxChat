package com.max.server;

import java.io.IOException;
import java.io.PrintWriter;
import java.net.InetSocketAddress;
import java.net.ServerSocket;
import java.net.Socket;
import java.util.ArrayList;

public class ChatServer {
	private InetSocketAddress ip;
	//private int port;
	private ArrayList<Socket> clients;
	private ServerSocket ss;
	private static ChatServer instance;
	
	private static int numClients = 0;
	
	public ChatServer  (InetSocketAddress ip) throws IOException{
		
		this.ip = ip;
		
		clients = new ArrayList<Socket>();
		
		ss = new ServerSocket();
		ss.bind(ip);
		System.out.println("ChatServer started on " + ip.getHostName() + " : " + ip.getPort());

		instance = this;
		
	}
	
	public static ChatServer getInstance() {
		return instance;	
	}
	
	public void checkForConnections() {
		Thread connection = new Thread(new ChatThread(this.ip));
		connection.start();
	}
	
	public void sendToClients(String message) {
		for (Socket client : clients) {
			PrintWriter out;
			try {
				out = new PrintWriter(client.getOutputStream());
				out.println(message);
			} catch (IOException e) {
				e.printStackTrace();
			}
		}
		
	}
	
	public void closeServer() throws IOException {
		ss.close();
	}

	public static int getNumClients() {
		return numClients;
	}

	public static void setNumClients(int numClients) {
		ChatServer.numClients = numClients;
	}
	
}
